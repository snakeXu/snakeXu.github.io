<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>网易微专业-jq源码解析-2.5.1 事件绑定-bind/delegate/on | 喵小喵的窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="说明：bind/delegate/on，在最近的jQuery版本中bind/delegate已经被on取代了，所以本节也是重点讲述on一、事件模型1、DOM0 DOM2事件模型2、事件流3、事件委托实例代码：  HTML代码： &amp;lt; ul id=&quot;proxy&quot;&amp;gt;     &amp;lt; li&amp;gt;主页&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;文章&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;官宣&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;简介&amp;lt; /l">
<meta property="og:type" content="article">
<meta property="og:title" content="网易微专业-jq源码解析-2.5.1 事件绑定-bind&#x2F;delegate&#x2F;on">
<meta property="og:url" content="http://yoursite.com/2019/11/10/网易微专业-jq源码解析-2-5-1-事件绑定-bind-delegate-on/index.html">
<meta property="og:site_name" content="喵小喵的窝">
<meta property="og:description" content="说明：bind/delegate/on，在最近的jQuery版本中bind/delegate已经被on取代了，所以本节也是重点讲述on一、事件模型1、DOM0 DOM2事件模型2、事件流3、事件委托实例代码：  HTML代码： &amp;lt; ul id=&quot;proxy&quot;&amp;gt;     &amp;lt; li&amp;gt;主页&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;文章&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;官宣&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;简介&amp;lt; /l">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_1.png">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_2.png">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_3.png">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_4.png">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_5.png">
<meta property="og:image" content="https://snakexu.github.io/images/wangyi/jq/on_6.png">
<meta property="og:updated_time" content="2019-11-15T07:25:40.719Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="网易微专业-jq源码解析-2.5.1 事件绑定-bind&#x2F;delegate&#x2F;on">
<meta name="twitter:description" content="说明：bind/delegate/on，在最近的jQuery版本中bind/delegate已经被on取代了，所以本节也是重点讲述on一、事件模型1、DOM0 DOM2事件模型2、事件流3、事件委托实例代码：  HTML代码： &amp;lt; ul id=&quot;proxy&quot;&amp;gt;     &amp;lt; li&amp;gt;主页&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;文章&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;官宣&amp;lt; /li&amp;gt;     &amp;lt; li&amp;gt;简介&amp;lt; /l">
<meta name="twitter:image" content="https://snakexu.github.io/images/wangyi/jq/on_1.png">
  
    <link rel="alternate" href="/atom.xml" title="喵小喵的窝" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">喵小喵的窝</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-网易微专业-jq源码解析-2-5-1-事件绑定-bind-delegate-on" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/10/网易微专业-jq源码解析-2-5-1-事件绑定-bind-delegate-on/" class="article-date">
  <time datetime="2019-11-10T09:45:59.000Z" itemprop="datePublished">2019-11-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      网易微专业-jq源码解析-2.5.1 事件绑定-bind/delegate/on
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>说明：bind/delegate/on，在最近的jQuery版本中bind/delegate已经被on取代了，所以本节也是重点讲述on<br>一、事件模型<br>1、DOM0 DOM2事件模型<br><img src="https://snakexu.github.io/images/wangyi/jq/on_1.png"><br>2、事件流<br><img src="https://snakexu.github.io/images/wangyi/jq/on_2.png"><br>3、事件委托<br><img src="https://snakexu.github.io/images/wangyi/jq/on_3.png"><br>实例代码：</p>
<pre>
HTML代码：
< ul id="proxy">
    < li>主页< /li>
    < li>文章< /li>
    < li>官宣< /li>
    < li>简介< /li>
< /ul>
js代码1：
var ElemUl = document.getElementById("proxy");
var ElemLi = ElemUl.getElementsByTagName('li');
for (var i = 0; i < ElemLi.length; i++) {
    ElemLi[i].onclick = function() {
        alert("loading...");
    }
}
js代码2：
var proxy = document.getElementById("proxy");
proxy.onclick = function(event) {
    var target = event.target;
    if (target.nodeName.toLowerCase() == 'li') {
        alert("loading...");
    }
}
</pre>
上面js代码1是大家马上能想出来的，代码2是利用了事件委托/事件代理，通过代理的方式，将事件绑定在ul上，这样性能表现会优于代码1
二、bind/delegate/on事件绑定解析
1、API
<img src="https://snakexu.github.io/images/wangyi/jq/on_4.png">
on相当于bind和delegate的集合
<img src="https://snakexu.github.io/images/wangyi/jq/on_5.png">
2、源码分析
(1)jQuery事件机制解决了哪些问题：<br>
·不同浏览器下的事件兼容<br>
·一个事件类型添加多个事件函数，一次添加多个事件类型的处理函数<br>
·简洁的定义方式<br>
·允许自定义事件<br>
实例：
<pre>
//多个事件绑定同一个函数
$("#id").on("mouseover mouseout", function() {
    console.log("loading...")
});

//多个事件绑定不同函数
$("#id").on({
    mouseover: function() {
        $("body").css("background-color", "lightgray");
    },
    mouseout: function() {
        $("body").css("background-color", "lightblue");
    },
    click: function() {
        $("body").css("background-color", "yellow");
    }
});

//绑定自定义事件
$("#id").on("myOwnEvent", function(event, showName) {
    console.log("loading...")
});
$("#id").trigger("myOwnEvent", ["max"]);
</pre>
3、jQuery事件设计原型
(1)原型图
<img src="https://snakexu.github.io/images/wangyi/jq/on_6.png">
在本课程中，老师对内容做了一些重构，并且没有做代理子元素事件，仅为自己绑定事件，也主要是为了方便大家的理解<br>
(2)源码
因为是基于之前代码的功能，所以这里代码显得比较多，其实很多都是之前的内容<br>
下面，我们把这次课程的代码单独拿出来，这样方便理解分析<br>
<pre>
jQuery.fn.extend({
    //这段代码中this是$('#id')里创建的实例对象
    //调用jQuery.each依次执行this对象里的内容
    each: function(callback, args) {
        return jQuery.each(this, callback, args);
    },
    //$("#id").on(事件，事件函数)
    //types:事件,fn:事件函数
    //绑定事件首先从这里on开始
    on: function(types, fn) {
        var type;
        //如果传递进来的types事件是对象/数组等
        if (typeof types === "object") {
            for (type in types) {
                this.on(types[type], fn);
            }
        }
        //如果传递进来的types参数不是对象
        //this.each就是jQuery.fn.each
        return this.each(function() {
            //this  element对象
            //jQuery.event是jQuery内置的一个事件系统
            jQuery.event.add(this, types, fn);
        });
    }
})
</pre>
jQuery.each代码
<pre>
/*
 object   目标源
 callback  回调函数
 args     自定义回调函数参数
 */
each: function(object, callback, args) {
    //object  数组对象 || object对象 
    //此处传递过来的object实例对象是jQuery的实例对象，有length的属性
    var length = object.length;
    var name, i = 0;

    // 自定义callback 参数
    if (args) {
        if (length === undefined) {
            for (name in object) {
                callback.apply(object, args);
            }
        } else {
            for (; i < length;) {
                callback.apply(object[i++], args);
            }
        }
    } else {
        if (length === undefined) {
            for (name in object) {
                callback.call(object, name, object[name]);
            }
        } else {
            //初始传进来的参数没有args，而jq本身有length属性，所以执行下面的循环
            for (; i < length;) {
                //callback是jQuery.event.add,依次对传进来的每一个实例化对象执行jQuery.event.add
                callback.call(object[i], i, object[i++]);
            }
        }
    }
},
</pre>
jQuery.event.add代码：
<pre>
//1:利用 data_priv 数据缓存,分离事件与数据 2:元素与缓存中建立 guid 的映射关系用于查找 
add: function(elem, type, handler) {
    //elem jQuery引擎所找到的DOM元素
    var eventHandle, events,handlers;
    //事件缓存 数据对象，data_priv来源在下面一段代码里
    var elemData = data_priv.get(elem);//一开始，elemData={}


    //检测handler是否存在ID(guid)如果没有那么传给他一个ID
    //添加ID的目的是 用来寻找或者删除相应的事件
    if (!handler.guid) {
        handler.guid = jQuery.guid++;   //guid == 1
    }
    /*
    给缓存增加事件处理句柄
    elemData = {
      events:
      handle:    
    }
    */
    //同一个元素,不同事件,不重复绑定    {events:{}}
    //变量=undefined 的结果为undefined,!undefined = true,
    //如果elemData.events已经存在，则判断条件为false
    if (!(events = elemData.events)) { 
        events = elemData.events = {};
    }
    if (!(eventHandle = elemData.handle)) {
        //Event 对象代表事件的状态 通过apply传递
        eventHandle = elemData.handle = function(e) {
            return jQuery.event.dispatch.apply(eventHandle.elem, arguments);
        }
    }
    eventHandle.elem = elem;
    //通过events存储同一个元素上的多个事件   {events:{click:[]}}   
    if (!(handlers = events[type])) {
        handlers = events[type] = [];
        handlers.delegateCount = 0;  //有多少事件代理默认0
    }
    handlers.push({
        type: type,
        handler: handler,
        guid: handler.guid,
    });
    //添加事件
    if (elem.addEventListener) {
        elem.addEventListener(type, eventHandle, false);
    }
},
</pre>
上面的代码中data_priv来源如下
<pre>
/**
 * Data 构造函数
 * 是为jQuery缓存所创建的数据仓库
 * 存储当前元素的事件名称、处理函数、子元素、子元素的事件名称、子元素的处理函数
 */
function Data() {
    //jQuery.expando是jQuery的静态属性,对于jQuery的每次加载运行期间时唯一的随机数
    this.expando = jQuery.expando + Math.random();//本质上就是生成了一个随机数
    this.cache = {};
}

Data.uid = 1;

Data.prototype = {
    key: function(elem) {
        var descriptor = {},
            unlock = elem[this.expando];

        if (!unlock) {
            unlock = Data.uid++;
            descriptor[this.expando] = {   //钥匙
                value: unlock
            };
            //方法直接在一个对象上定义一个或多个新的属性或修改现有属性,并返回该对象。
            //DOM   =>  jQuery101089554822917892030.7449198463843298 = 1;
            Object.defineProperties(elem, descriptor);
        }
        //确保缓存对象记录信息
        if (!this.cache[unlock]) {
            this.cache[unlock] = {};   //  数据
        }

        return unlock;
    },

    get: function(elem, key) {
        //找到或者创建缓存,第一次执行的时候this.key[elem]=1,this.cache[1]={}
        var cache = this.cache[this.key(elem)];    //1  {events:{},handle:function(){}} 
        //key 有值直接在缓存中取读
        return key === undefined ? cache : cache[key];
    },
}

var data_priv = new Data();
</pre>
jQuery.event.dispatch代码
<pre>
//修复事件对象event(进行兼容性的处理) 从缓存体中的events对象取得对应队列。
dispatch: function(event) {
    //IE兼容性处理如：event.target or event.srcElement
    //event = jQuery.event.fix(event);

    //提取当前元素在cache中的events属性值。 click
    var handlers = (data_priv.get(this, "events") || {})[event.type] || [];
    event.delegateTarget = this;
    //执行事件处理函数
   jQuery.event.handlers.call( this, event, handlers );
},
</pre>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2019/11/10/网易微专业-jq源码解析-2-5-1-事件绑定-bind-delegate-on/" data-id="ck2zv8pks0006cnxqmuoa8ki5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/15/网易微专业-jq源码解析-事件绑定-体系结构-完整源码/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          网易微专业-jq源码解析-事件绑定-体系结构-完整源码
        
      </div>
    </a>
  
  
    <a href="/2019/11/09/网易微专业-jq源码解析-1107直播课deferred相关/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">网易微专业-jq源码解析-1107直播课deferred相关</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/11/15/轮询/">轮询</a>
          </li>
        
          <li>
            <a href="/2019/11/15/网易微专业-jq源码解析-事件绑定-体系结构-完整源码/">网易微专业-jq源码解析-事件绑定-体系结构-完整源码</a>
          </li>
        
          <li>
            <a href="/2019/11/10/网易微专业-jq源码解析-2-5-1-事件绑定-bind-delegate-on/">网易微专业-jq源码解析-2.5.1 事件绑定-bind/delegate/on</a>
          </li>
        
          <li>
            <a href="/2019/11/09/网易微专业-jq源码解析-1107直播课deferred相关/">网易微专业-jq源码解析-1107直播课deferred相关</a>
          </li>
        
          <li>
            <a href="/2019/11/08/网易微专业-jq源码解析-2-4-1-延时对象-Deferred概念-源码剖析/">网易微专业-jq源码解析-2.4.1-延时对象-Deferred概念 &amp; 源码剖析</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 snakeXu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>